<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd">

    <changeSet id="table_users" author="weslly">
        <createTable tableName="users">
            <column name="user_id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false" unique="true"/>
            </column>
            <column name="name" type="VARCHAR(50)"/>
            <column name="surname" type="VARCHAR(50)"/>
            <column name="email" type="VARCHAR(50)">
                <constraints unique="true"/>
            </column>
            <column name="username" type="VARCHAR(50)">
                <constraints unique="true"/>
            </column>
            <column name="password" type="VARCHAR(512)"/>
            <column name="status" type="BOOLEAN" defaultValueBoolean="true"/>
            <column name="created" type="TIMESTAMP"/>
            <column name="profile_id" type="BIGINT"/>
        </createTable>
    </changeSet>

    <changeSet id="table_profile" author="weslly">
        <createTable tableName="profiles">
            <column name="profile_id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false" unique="true"/>
            </column>
            <column name="name" type="VARCHAR(20)"/>
            <column name="description" type="VARCHAR(50)"/>
            <column name="status" type="BOOLEAN"/>
        </createTable>
    </changeSet>

    <changeSet id="table_role" author="weslly">
        <createTable tableName="roles">
            <column name="role_id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false" unique="true"/>
            </column>
            <column name="name" type="VARCHAR(20)"/>
            <column name="description" type="VARCHAR(50)"/>
            <column name="status" type="BOOLEAN"/>
        </createTable>
    </changeSet>

    <changeSet id="detail_profile_role" author="weslly">
        <createTable tableName="profile_role">
            <column name="role_id" type="BIGINT"/>
            <column name="profile_id" type="BIGINT"/>
        </createTable>
    </changeSet>

    <changeSet id="table_publication" author="weslly">
        <createTable tableName="publications">
            <column name="publication_id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false" unique="true"/>
            </column>
            <column name="title" type="VARCHAR(50)"/>
            <column name="description" type="VARCHAR(256)"/>
            <column name="date_creation" type="TIMESTAMP"/>
            <column name="date_update" type="TIMESTAMP"/>
            <column name="user_id" type="BIGINT"/>
        </createTable>
    </changeSet>

    <changeSet id="table_tag" author="weslly">
        <createTable tableName="tags">
            <column name="tag_id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false" unique="true"/>
            </column>
            <column name="name" type="VARCHAR(15)"/>
            <column name="description" type="VARCHAR(30)"/>
            <column name="status" type="BOOLEAN"/>
        </createTable>
    </changeSet>

    <changeSet id="table" author="weslly">
        <createTable tableName="comments">
            <column name="comment_id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false" unique="true"/>
            </column>
            <column name="description" type="VARCHAR(255)"/>
            <column name="date_creation" type="TIMESTAMP"/>
            <column name="date_update" type="TIMESTAMP"/>
            <column name="publication_id" type="BIGINT"/>
            <column name="user_id" type="BIGINT"/>
        </createTable>
    </changeSet>

    <changeSet id="table_question" author="weslly">
        <createTable tableName="questions">
            <column name="question_id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false" unique="true"/>
            </column>
            <column name="title" type="VARCHAR(50)"/>
            <column name="description" type="VARCHAR(255)"/>
            <column name="date_creation" type="TIMESTAMP"/>
            <column name="date_update" type="TIMESTAMP"/>
            <column name="user_id" type="BIGINT"/>
        </createTable>
    </changeSet>

    <changeSet id="table_answer" author="weslly">
        <createTable tableName="answers">
            <column name="answer_id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false" unique="true"/>
            </column>
            <column name="description" type="VARCHAR(255)"/>
            <column name="date_creation" type="TIMESTAMP"/>
            <column name="date_update" type="TIMESTAMP"/>
            <column name="like" type="INTEGER"/>
            <column name="verified" type="BOOLEAN"/>
            <column name="question_id" type="BIGINT"/>
            <column name="user_id" type="BIGINT"/>
        </createTable>
    </changeSet>

    <changeSet id="detail_question_tag" author="weslly">
        <createTable tableName="question_tag">
            <column name="tag_id" type="BIGINT" autoIncrement="true">
                <constraints nullable="false"/>
            </column>
            <column name="question_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="detail_publication_tag" author="weslly">
        <createTable tableName="publication_tag">
            <column name="tag_id" type="BIGINT" autoIncrement="true">
                <constraints nullable="false"/>
            </column>
            <column name="publication_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="foreign_keys" author="weslly">
        <addForeignKeyConstraint baseTableName="profile_role"
                                 baseColumnNames="profile_id"
                                 constraintName="fk_profile_role_profile"
                                 referencedTableName="profiles"
                                 referencedColumnNames="profile_id"/>

        <addForeignKeyConstraint baseTableName="roles"
                                 baseColumnNames="role_id"
                                 constraintName="fk_profile_role_role"
                                 referencedTableName="roles"
                                 referencedColumnNames="role_id"/>

        <addForeignKeyConstraint baseTableName="users"
                                 baseColumnNames="profile_id"
                                 constraintName="fk_user_profile"
                                 referencedTableName="profiles"
                                 referencedColumnNames="profile_id"/>

        <addForeignKeyConstraint baseTableName="publications"
                                 baseColumnNames="user_id"
                                 constraintName="fk_publication_user"
                                 referencedTableName="users"
                                 referencedColumnNames="user_id"/>

        <addForeignKeyConstraint baseTableName="comments"
                                 baseColumnNames="publication_id"
                                 constraintName="fk_comment_publication"
                                 referencedTableName="publications"
                                 referencedColumnNames="publication_id"/>

        <addForeignKeyConstraint baseTableName="comments"
                                 baseColumnNames="user_id"
                                 constraintName="fk_comment_user"
                                 referencedTableName="users"
                                 referencedColumnNames="user_id"/>

        <addForeignKeyConstraint baseTableName="questions"
                                 baseColumnNames="user_id"
                                 constraintName="fk_question_user"
                                 referencedTableName="users"
                                 referencedColumnNames="user_id"/>

        <addForeignKeyConstraint baseTableName="answers"
                                 baseColumnNames="user_id"
                                 constraintName="fk_answer_user"
                                 referencedTableName="users"
                                 referencedColumnNames="user_id"/>

        <addForeignKeyConstraint baseTableName="answers"
                                 baseColumnNames="question_id"
                                 constraintName="fk_answer_question"
                                 referencedTableName="questions"
                                 referencedColumnNames="question_id"/>

        <addForeignKeyConstraint baseTableName="publication_tag"
                                 baseColumnNames="publication_id"
                                 constraintName="fk_publication_tag_publication"
                                 referencedTableName="publications"
                                 referencedColumnNames="publication_id"/>

        <addForeignKeyConstraint baseTableName="publication_tag"
                                 baseColumnNames="tag_id"
                                 constraintName="fk_publication_tag_tag"
                                 referencedTableName="tags"
                                 referencedColumnNames="tag_id"/>

        <addForeignKeyConstraint baseTableName="question_tag"
                                 baseColumnNames="question_id"
                                 constraintName="fk_question_tag_question"
                                 referencedTableName="questions"
                                 referencedColumnNames="question_id"/>

        <addForeignKeyConstraint baseTableName="question_tag"
                                 baseColumnNames="tag_id"
                                 constraintName="fk_question_tag_tag"
                                 referencedTableName="tags"
                                 referencedColumnNames="tag_id"/>
    </changeSet>
</databaseChangeLog>